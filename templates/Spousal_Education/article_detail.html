{% extends 'Base.html' %}
{% load static %}

{% block title %}{{ article.title }} - Spousal Education{% endblock title %}

{% block body_block %}
<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'Spousal_Education:article_list' %}">Education Hub</a></li>
                    <li class="breadcrumb-item"><a href="?category={{ article.category.slug }}">{{ article.category.name }}</a></li>
                    <li class="breadcrumb-item active">{{ article.title|truncatewords:5 }}</li>
                </ol>
            </nav>

            <!-- Article Header -->
            <div style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #d946ef 100%); padding: 3rem; border-radius: 24px; color: white; margin-bottom: 2.5rem; position: relative; overflow: hidden; box-shadow: 0 15px 40px rgba(99, 102, 241, 0.3);">
                <div style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url('data:image/svg+xml,%3Csvg width=\"60\" height=\"60\" viewBox=\"0 0 60 60\" xmlns=\"http://www.w3.org/2000/svg\"%3E%3Cg fill=\"none\" fill-rule=\"evenodd\"%3E%3Cg fill=\"%23ffffff\" fill-opacity=\"0.05\"%3E%3Cpath d=\"M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z\"/%3E%3C/g%3E%3C/g%3E%3C/svg%3E'); opacity: 0.2;\"></div>
                <div style="position: relative; z-index: 1;">
                    <div style="display: flex; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 0.75rem;">
                        <span style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1.2rem; border-radius: 50px; font-size: 0.9rem; font-weight: 700; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            {{ article.category.icon }} {{ article.category.name }}
                        </span>
                        <span class="badge" style="background: rgba(255, 255, 255, 0.2); font-size: 0.85rem; padding: 0.5rem 1rem; border-radius: 50px; backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.2);">
                            {{ article.get_difficulty_level_display }}
                        </span>
                    </div>
                    <h1 style="font-size: 2.75rem; font-weight: 800; margin-bottom: 1.25rem; line-height: 1.2; text-shadow: 0 2px 20px rgba(0,0,0,0.15);">{{ article.title }}</h1>
                    <p style="font-size: 1.2rem; opacity: 0.95; margin-bottom: 2rem; line-height: 1.6;">{{ article.summary }}</p>
                    
                    <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 2rem; font-size: 0.95rem; opacity: 0.95;">
                        <span style="display: flex; align-items: center; gap: 0.5rem;\"><i class="fa fa-user\"></i> {{ article.author.get_full_name|default:article.author.username }}</span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;\"><i class="fa fa-calendar\"></i> {{ article.published_date|date:"M d, Y" }}</span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;\"><i class="fa fa-clock-o\"></i> {{ article.estimated_read_time }} min read</span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;\"><i class="fa fa-eye\"></i> {{ article.views_count }} views</span>
                        <span style="display: flex; align-items: center; gap: 0.5rem;\"><i class="fa fa-heart\"></i> {{ article.likes_count }} likes</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            {% if user.is_authenticated %}
            <div class="mb-4" style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <form method="post" action="{% url 'Spousal_Education:toggle_like' article.slug %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn" style="background: {% if user_has_liked %}linear-gradient(135deg, #ef4444, #dc2626){% else %}#f8f9fa{% endif %}; color: {% if user_has_liked %}white{% else %}#64748b{% endif %}; border: 2px solid {% if user_has_liked %}#ef4444{% else %}#e2e8f0{% endif %}; font-weight: 700; padding: 0.75rem 1.5rem; border-radius: 50px; box-shadow: {% if user_has_liked %}0 4px 12px rgba(239, 68, 68, 0.3){% else %}0 2px 8px rgba(0,0,0,0.05){% endif %}; transition: all 0.3s;">
                        <i class="fa fa-heart"></i> {% if user_has_liked %}Liked{% else %}Like Article{% endif %} ({{ article.likes_count }})
                    </button>
                </form>
                <form method="post" action="{% url 'Spousal_Education:toggle_bookmark' article.slug %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn" style="background: {% if user_has_bookmarked %}linear-gradient(135deg, #6366f1, #8b5cf6){% else %}#f8f9fa{% endif %}; color: {% if user_has_bookmarked %}white{% else %}#64748b{% endif %}; border: 2px solid {% if user_has_bookmarked %}#6366f1{% else %}#e2e8f0{% endif %}; font-weight: 700; padding: 0.75rem 1.5rem; border-radius: 50px; box-shadow: {% if user_has_bookmarked %}0 4px 12px rgba(99, 102, 241, 0.3){% else %}0 2px 8px rgba(0,0,0,0.05){% endif %}; transition: all 0.3s;">
                        <i class="fa fa-bookmark"></i> {% if user_has_bookmarked %}Saved{% else %}Save Article{% endif %}
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- Article Content -->
            <div style="background: white; padding: 3rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); margin-bottom: 2.5rem; border: 1px solid #e2e8f0;">
                <div style="font-size: 1.1rem; line-height: 1.9; color: #334155;">
                    {{ article.content|linebreaks }}
                </div>
            </div>

            <!-- Key Takeaways -->
            {% if article.key_takeaways %}
            <div style="background: linear-gradient(135deg, #eff6ff 0%, #f5f3ff 100%); padding: 2.5rem; border-radius: 20px; border-left: 6px solid #6366f1; margin-bottom: 2.5rem; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.1);">
                <h3 style="color: #6366f1; font-weight: 800; margin-bottom: 1.5rem; font-size: 1.5rem; display: flex; align-items: center; gap: 0.75rem;">
                    <span style="width: 40px; height: 40px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">üí°</span>
                    Key Takeaways
                </h3>
                <div style="color: #475569; line-height: 1.9; font-size: 1.05rem;">
                    {{ article.key_takeaways|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Comments Section -->
            <div style="background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.06); margin-bottom: 2.5rem; border: 1px solid #e2e8f0;">
                <h3 style="color: #1e293b; font-weight: 800; margin-bottom: 2rem; font-size: 1.75rem; display: flex; align-items: center; gap: 0.75rem;">
                    <span style="width: 40px; height: 40px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">üí¨</span>
                    Comments ({{ comments.count }})
                </h3>
                
                {% if user.is_authenticated %}
                <form method="post" class="mb-4" style="background: #f8fafc; padding: 1.75rem; border-radius: 16px; border: 2px solid #e2e8f0;">
                    {% csrf_token %}
                    <div class="mb-3">
                        {{ comment_form.content }}
                    </div>
                    <button type="submit" class="btn" style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none; font-weight: 700; padding: 0.75rem 2rem; border-radius: 50px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); transition: all 0.3s;">
                        Post Comment
                    </button>
                </form>
                {% else %}
                <div class="alert" style="background: linear-gradient(135deg, #eff6ff, #f5f3ff); border: 2px solid #ddd6fe; border-radius: 16px; padding: 1.5rem; color: #475569; font-weight: 600;">
                    <a href="{% url 'App_Login:signin' %}" style="color: #6366f1; font-weight: 700; text-decoration: none;">Login</a> to post a comment and join the conversation.
                </div>
                {% endif %}

                <hr style="margin: 2.5rem 0; border: none; height: 2px; background: #f1f5f9;">

                {% for comment in comments %}
                <div style="border-left: 4px solid #6366f1; padding-left: 1.5rem; margin-bottom: 2rem; background: #f8fafc; padding: 1.5rem; padding-left: 1.75rem; border-radius: 0 12px 12px 0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; flex-wrap: wrap; gap: 0.5rem;">
                        <strong style="color: #1e293b; font-weight: 700; font-size: 1.05rem;">{{ comment.user.get_full_name|default:comment.user.username }}</strong>
                        <small style="color: #94a3b8; font-weight: 600;">{{ comment.created_at|timesince }} ago</small>
                    </div>
                    <p style="color: #475569; margin-bottom: 0.75rem; line-height: 1.7;">{{ comment.content }}</p>
                    {% if user.is_authenticated and comment.user == user or user.is_staff %}
                    <form method="post" action="{% url 'Spousal_Education:delete_comment' comment.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm" style="background: #fee2e2; color: #dc2626; border: 1px solid #fecaca; font-weight: 600; padding: 0.4rem 1rem; border-radius: 50px; font-size: 0.85rem;" onclick="return confirm('Delete this comment?')">Delete</button>
                    </form>
                    {% endif %}
                </div>
                {% empty %}
                <div style="text-align: center; padding: 3rem 1rem; background: #f8fafc; border-radius: 16px;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.4;">üí¨</div>
                    <p style="color: #94a3b8; font-size: 1.05rem; font-weight: 600;">No comments yet. Be the first to share your thoughts!</p>
                </div>
                {% endfor %}
            </div>

            <!-- Related Articles -->
            {% if related_articles %}
            <div style="background: linear-gradient(135deg, #eff6ff 0%, #f5f3ff 100%); padding: 2.5rem; border-radius: 20px; margin-bottom: 2.5rem; box-shadow: 0 8px 20px rgba(99, 102, 241, 0.08);">
                <h3 style="color: #1e293b; font-weight: 800; margin-bottom: 2rem; font-size: 1.75rem; display: flex; align-items: center; gap: 0.75rem;">
                    <span style="width: 40px; height: 40px; background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.25rem;">üìö</span>
                    Related Articles
                </h3>
                <div class="row">
                    {% for related in related_articles %}
                    <div class="col-md-4 mb-3">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-radius: 16px; overflow: hidden; transition: all 0.3s; background: white;">
                            <div style="height: 4px; background: linear-gradient(90deg, #6366f1, #8b5cf6);"></div>
                            <div class="card-body" style="padding: 1.5rem;">
                                <h5 style="font-size: 1.05rem; font-weight: 700; margin-bottom: 0.75rem; line-height: 1.4;">
                                    <a href="{% url 'Spousal_Education:article_detail' related.slug %}" style="color: #1e293b; text-decoration: none;">
                                        {{ related.title|truncatewords:8 }}
                                    </a>
                                </h5>
                                <small style="color: #94a3b8; font-weight: 600; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fa fa-clock-o"></i> {{ related.estimated_read_time }} min read
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Back Button -->
            <div class="text-center">
                <a href="{% url 'Spousal_Education:article_list' %}" class="btn" style="background: white; color: #6366f1; border: 2px solid #6366f1; font-weight: 700; padding: 0.75rem 2rem; border-radius: 50px; transition: all 0.3; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);">
                    ‚Üê Back to All Articles
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
