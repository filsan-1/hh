{% extends 'Base.html' %}
{% load static %}

{% block title %}{{ article.title }} - Spousal Education{% endblock title %}

{% block body_block %}
<div class="container mt-4 mb-5">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <!-- Breadcrumb -->
            <nav aria-label="breadcrumb" class="mb-3">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'Spousal_Education:article_list' %}">Education Hub</a></li>
                    <li class="breadcrumb-item"><a href="?category={{ article.category.slug }}">{{ article.category.name }}</a></li>
                    <li class="breadcrumb-item active">{{ article.title|truncatewords:5 }}</li>
                </ol>
            </nav>

            <!-- Article Header -->
            <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 2.5rem; border-radius: 15px; color: white; margin-bottom: 2rem;">
                <div style="display: flex; align-items: center; margin-bottom: 1rem; flex-wrap: wrap; gap: 0.5rem;">
                    <span style="background: rgba(255, 255, 255, 0.25); padding: 0.4rem 0.9rem; border-radius: 20px; font-size: 0.9rem; font-weight: 600;">
                        {{ article.category.icon }} {{ article.category.name }}
                    </span>
                    <span class="badge" style="background: rgba(255, 255, 255, 0.25); font-size: 0.85rem;">
                        {{ article.get_difficulty_level_display }}
                    </span>
                </div>
                <h1 style="font-size: 2.2rem; font-weight: 700; margin-bottom: 1rem; line-height: 1.3;">{{ article.title }}</h1>
                <p style="font-size: 1.1rem; opacity: 0.95; margin-bottom: 1.5rem;">{{ article.summary }}</p>
                
                <div style="display: flex; align-items: center; flex-wrap: wrap; gap: 1.5rem; font-size: 0.9rem; opacity: 0.9;">
                    <span><i class="fa fa-user"></i> {{ article.author.get_full_name|default:article.author.username }}</span>
                    <span><i class="fa fa-calendar"></i> {{ article.published_date|date:"M d, Y" }}</span>
                    <span><i class="fa fa-clock-o"></i> {{ article.estimated_read_time }} min read</span>
                    <span><i class="fa fa-eye"></i> {{ article.views_count }} views</span>
                    <span><i class="fa fa-heart"></i> {{ article.likes_count }} likes</span>
                </div>
            </div>

            <!-- Action Buttons -->
            {% if user.is_authenticated %}
            <div class="mb-4" style="display: flex; gap: 1rem;">
                <form method="post" action="{% url 'Spousal_Education:toggle_like' article.slug %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn" style="background: {% if user_has_liked %}#dc3545{% else %}#f8f9fa{% endif %}; color: {% if user_has_liked %}white{% else %}#666{% endif %}; border: 1px solid #ddd; font-weight: 600;">
                        <i class="fa fa-heart"></i> {% if user_has_liked %}Liked{% else %}Like{% endif %} ({{ article.likes_count }})
                    </button>
                </form>
                <form method="post" action="{% url 'Spousal_Education:toggle_bookmark' article.slug %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn" style="background: {% if user_has_bookmarked %}#667eea{% else %}#f8f9fa{% endif %}; color: {% if user_has_bookmarked %}white{% else %}#666{% endif %}; border: 1px solid #ddd; font-weight: 600;">
                        <i class="fa fa-bookmark"></i> {% if user_has_bookmarked %}Bookmarked{% else %}Bookmark{% endif %}
                    </button>
                </form>
            </div>
            {% endif %}

            <!-- Article Content -->
            <div style="background: white; padding: 2.5rem; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 2rem;">
                <div style="font-size: 1.05rem; line-height: 1.8; color: #333;">
                    {{ article.content|linebreaks }}
                </div>
            </div>

            <!-- Key Takeaways -->
            {% if article.key_takeaways %}
            <div style="background: linear-gradient(135deg, #f5f7ff 0%, #fef5ff 100%); padding: 2rem; border-radius: 12px; border-left: 5px solid #667eea; margin-bottom: 2rem;">
                <h3 style="color: #667eea; font-weight: 700; margin-bottom: 1rem;">üí° Key Takeaways</h3>
                <div style="color: #555; line-height: 1.8;">
                    {{ article.key_takeaways|linebreaks }}
                </div>
            </div>
            {% endif %}

            <!-- Comments Section -->
            <div style="background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 2rem;">
                <h3 style="color: #667eea; font-weight: 700; margin-bottom: 1.5rem;">üí¨ Comments ({{ comments.count }})</h3>
                
                {% if user.is_authenticated %}
                <form method="post" class="mb-4">
                    {% csrf_token %}
                    <div class="mb-3">
                        {{ comment_form.content }}
                    </div>
                    <button type="submit" class="btn" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none; font-weight: 600;">
                        Post Comment
                    </button>
                </form>
                {% else %}
                <div class="alert alert-info">
                    <a href="{% url 'App_Login:signin' %}">Login</a> to post a comment.
                </div>
                {% endif %}

                <hr style="margin: 2rem 0;">

                {% for comment in comments %}
                <div style="border-left: 3px solid #667eea; padding-left: 1.25rem; margin-bottom: 1.5rem;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                        <strong style="color: #333;">{{ comment.user.get_full_name|default:comment.user.username }}</strong>
                        <small style="color: #999;">{{ comment.created_at|timesince }} ago</small>
                    </div>
                    <p style="color: #555; margin-bottom: 0.5rem;">{{ comment.content }}</p>
                    {% if user.is_authenticated and comment.user == user or user.is_staff %}
                    <form method="post" action="{% url 'Spousal_Education:delete_comment' comment.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-danger" onclick="return confirm('Delete this comment?')">Delete</button>
                    </form>
                    {% endif %}
                </div>
                {% empty %}
                <p style="text-align: center; color: #999; padding: 2rem 0;">No comments yet. Be the first to share your thoughts!</p>
                {% endfor %}
            </div>

            <!-- Related Articles -->
            {% if related_articles %}
            <div style="background: linear-gradient(135deg, #f5f7ff 0%, #fef5ff 100%); padding: 2rem; border-radius: 12px; margin-bottom: 2rem;">
                <h3 style="color: #667eea; font-weight: 700; margin-bottom: 1.5rem;">üìö Related Articles</h3>
                <div class="row">
                    {% for related in related_articles %}
                    <div class="col-md-4 mb-3">
                        <div class="card h-100" style="border: none; box-shadow: 0 2px 8px rgba(0,0,0,0.08);">
                            <div class="card-body">
                                <h5 style="font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem;">
                                    <a href="{% url 'Spousal_Education:article_detail' related.slug %}" style="color: #333; text-decoration: none;">
                                        {{ related.title|truncatewords:8 }}
                                    </a>
                                </h5>
                                <small style="color: #999;">
                                    <i class="fa fa-clock-o"></i> {{ related.estimated_read_time }} min
                                </small>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Back Button -->
            <div class="text-center">
                <a href="{% url 'Spousal_Education:article_list' %}" class="btn btn-outline-secondary">
                    ‚Üê Back to All Articles
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
