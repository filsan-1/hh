{% extends 'Base.html' %}
{% load crispy_forms_tags %}

{% block title %}Chat with {{ other_user.get_full_name|default:other_user.username }} - Hormone Harmony{% endblock title %}

{% block body_block %}
<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 offset-lg-2">
            <!-- Header -->
            <div style="background: linear-gradient(135deg, #FFC0E0 0%, #FFE4F5 100%); padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h4 style="margin: 0; color: #333; font-weight: 700;">ğŸ’¬ {{ other_user.get_full_name|default:other_user.username }}</h4>
                    <small style="color: #666;">@{{ other_user.username }}</small>
                </div>
                <div>
                    <a href="{% url 'App_Messaging:conversation_list' %}" class="btn btn-outline-secondary btn-sm">â† Back</a>
                    <form method="post" action="{% url 'App_Messaging:delete_conversation' conversation.id %}" style="display: inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Delete this conversation?')">ğŸ—‘ï¸ Delete</button>
                    </form>
                </div>
            </div>
            
            <!-- Messages -->
            <div style="background: linear-gradient(135deg, #FFF5FB 0%, #FFFAF0 100%); border: 1px solid #FFD7E8; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; max-height: 550px; overflow-y: auto; min-height: 350px;">
                {% for message in chat_messages %}
                    {% if message.sender == request.user %}
                        <div style="margin-bottom: 1.5rem; display: flex; justify-content: flex-end;">
                            <div style="background: linear-gradient(135deg, #FF69B4, #FF1493); color: white; padding: 0.75rem 1.25rem; border-radius: 18px; max-width: 70%; box-shadow: 0 2px 6px rgba(255, 20, 147, 0.2);">
                                <p style="margin: 0; word-wrap: break-word; font-size: 0.95rem;">{{ message.content }}</p>
                                <small style="opacity: 0.85; font-size: 0.75rem;">{{ message.created_at|date:"H:i" }}</small>
                            </div>
                        </div>
                    {% else %}
                        <div style="margin-bottom: 1.5rem; display: flex; justify-content: flex-start;">
                            <div style="background: #E0E0E0; color: #333; padding: 0.75rem 1.25rem; border-radius: 18px; max-width: 70%; box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);">
                                <p style="margin: 0; word-wrap: break-word; font-size: 0.95rem;">{{ message.content }}</p>
                                <small style="opacity: 0.7; font-size: 0.75rem;">{{ message.created_at|date:"H:i" }}</small>
                            </div>
                        </div>
                    {% endif %}
                {% empty %}
                    <p style="text-align: center; color: #999; padding: 2rem 0;">ğŸ‘‹ Start the conversation!</p>
                {% endfor %}
            </div>
            
            <!-- Message Form -->
            <form method="post">
                <div style="display: flex; gap: 0.75rem;">
                    {% csrf_token %}
                    <div style="flex: 1;">
                        {{ form.content }}
                    </div>
                    <button type="submit" class="btn" style="background: linear-gradient(135deg, #FF69B4, #FF1493); color: white; border: none; font-weight: 600; padding: 0.5rem 1.5rem; border-radius: 8px;">
                        ğŸ“¤ Send
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Auto-scroll to bottom
const messageDiv = document.querySelector('div[style*="max-height: 550px"]');
if (messageDiv) {
    messageDiv.scrollTop = messageDiv.scrollHeight;
}
</script>

<style>
    @media (max-width: 768px) {
        .col-lg-8 { max-width: 100%; padding: 0.5rem; }
    }
</style>
{% endblock %}
